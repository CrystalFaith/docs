---
class: post-blog post-detail
type: Blog
$title: "Developer Preview of better AMP URLs in Google Search"
id: developer-preview-of-better-amp-urls-in-google-search
author: Greg Grothaus
role:  Software Engineer, AMP at Google
origin: "https://amphtml.wordpress.com/2018/11/13/developer-preview-of-better-amp-urls-in-google-search/amp/"
excerpt: "AMP users and publishers have told us that they prefer that the original domain names be used anywhere their AMP pages are displayed. Earlier this year, we demonstrated a technology named Signed HTTP Exchanges that supports transforming cached AMP URLs on any AMP Cache. Google Chrome has since started an origin trial for Signed Exchanges [&#8230;]"
avatar: https://1.gravatar.com/avatar/42ecb1ea497ca9d0ffe1e406cae70e27?s=96&d=identicon&r=G
date_data: 2018-11-13T10:10:09-08:00
$date: November 13, 2018
$parent: /content/latest/list-blog.html
$path: /latest/blog/{base}/
$localization:
  path: /{locale}/latest/blog/{base}/
components:
  - social-share
  - anim
inlineCSS: .amp-wp-inline-329fdb7771c10d07df9eb73273c95a60{font-weight:400;}
---

<div class="amp-wp-article-content">

		<p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">AMP users and publishers have told us that they prefer that the original domain names be used anywhere their AMP pages are displayed.</span></p><p><amp-anim class="aligncenter  wp-image-2257 amp-wp-enforced-sizes" src="https://amphtml.files.wordpress.com/2018/11/url_bar2.gif?w=654&amp;h=74" alt="url_bar" width="654" height="74" sizes="(min-width: 654px) 654px, 100vw"></amp-anim><br/><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Earlier this year, we </span><a href="https://amphtml.wordpress.com/2018/05/08/a-first-look-at-using-web-packaging-to-improve-amp-urls/"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">demonstrated a technology</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60"> named </span><a href="https://wicg.github.io/webpackage/draft-yasskin-http-origin-signed-responses.html"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Signed HTTP Exchanges</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60"> that supports transforming cached AMP URLs on any AMP Cache. Google Chrome has since started an </span><a href="https://developers.google.com/web/updates/2018/11/signed-exchanges"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">origin trial for Signed Exchanges</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60"> in Chrome 71. Today Google Search is opening up a developer preview of this technology that any publisher can try out for themselves.</span></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Signed Exchanges, used by an AMP Cache, have benefits for users and publishers, beyond the visual experience of the URL bar. Signed Exchanges also:</span></p><ul><li class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Provide a guarantee, using cryptographic signatures, that the content is exactly what the publisher intended to show the user.</span></li>
<li class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Allow the browser to treat a document as belonging to the publisher’s </span><a href="https://en.wikipedia.org/wiki/Same-origin_policy"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Origin</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">. This allows a publisher to use first party cookies to customize content, execute service workers, and measure analytics.</span></li>
</ul><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Signed Exchanges are part of a wider web proposal named Web Packaging. The Web Packaging specifications, <a href="https://www.w3.org/TR/2015/WD-web-packaging-20150115/">first proposed in 2015 as a W3C draft</a> are evolving over time with feedback from members of standards bodies, other browser vendors, security experts, and publishers and web developers.</span></p><h2><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Steps to try a Google Search demonstration</span></h2><ol><li class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Signed Exchanges are currently only enabled in Chrome version 71 or greater. At the time of writing, this requires </span><a href="https://www.google.com/chrome/beta/"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">installing from the Chrome Beta channel</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60"> but it will soon be released to all Chrome channels.</span></li>
<li class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">If you are not using a mobile device such as a smartphone or a tablet, enable mobile emulation on your browser. AMP pages are only displayed to mobile devices. Next, visit </span><a href="https://g.co/webpackagedemo"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">https://g.co/webpackagedemo</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">.</span></li>
<li class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">This will display a search box. From there, enter a query such as [learn amp by example] and click on “Learn AMP by Example” for the ampbyexample.com home page. There are only a small number of publishers that have implemented this feature so far, so you may want to try this specific query. If you’ve completed these steps correctly, you will see “https://ampbyexample.com” displayed in the browser’s URL bar.</span></li>
</ol><p><amp-anim class="  wp-image-2252 aligncenter amp-wp-enforced-sizes" src="https://amphtml.files.wordpress.com/2018/11/abe_demo.gif?w=352&amp;h=705" alt="abe_demo" width="352" height="705" sizes="(min-width: 352px) 352px, 100vw"></amp-anim></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">That’s it! The AMP Cache has preloaded the AMP document and Chrome has cryptographically verified that the AMP document was never modified from what the publisher intended, thus enabling the publisher’s URL to be the one that populates the browser address bar.</span></p><h2><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Under the hood</span></h2><p> </p><h3><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Prefetching</span></h3><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">The moment a Google Search returns an AMP result, the Search results page instructs the browser to fetch the AMP document, “prefetching” it by the device in the background.</span></p><p><amp-img class="  wp-image-2251 alignright amp-wp-enforced-sizes" src="https://amphtml.files.wordpress.com/2018/11/search_example.png?w=273&amp;h=305" alt="search_example" width="273" height="305" srcset="https://amphtml.files.wordpress.com/2018/11/search_example.png?w=273&amp;h=305 273w, https://amphtml.files.wordpress.com/2018/11/search_example.png?w=134&amp;h=150 134w, https://amphtml.files.wordpress.com/2018/11/search_example.png?w=269&amp;h=300 269w, https://amphtml.files.wordpress.com/2018/11/search_example.png 412w" sizes="(min-width: 273px) 273px, 100vw"></amp-img></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">When a user clicks on that result, the AMP document can be displayed instantly. This works in part because the document clicked was already fetched and partially loaded. </span></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Heavy resources like images and videos haven’t all been fetched in advance, but the AMP JavaScript libraries make sure to reserve space on the document for those and optimizes the order of loading them. This saves bandwidth if the user doesn’t end up clicking. It also protects the user’s privacy.</span></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">An important privacy principle is that until the user clicks on a document, third parties should not be able to determine that the user is interested in it. If preload caused a browser to make network requests to servers other than Google’s, then some of the intent of user queries would leak to sites the user never even clicked on. </span></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">To achieve this, neither the document nor any resources fetched before loading the document, can be fetched from third parties. Only once the user has signaled intent to load the document by tapping it do those resources get fetched. We call this mechanism “Privacy Preserving Prefetching” and it provides a buffer between the user and the publisher until the user has chosen which document to visit.</span></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">In order to preserve privacy while still prefetching documents, the referrer, Google Search in this case, must load the document from a Google server, the Google AMP Cache.</span></p><h3><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Signed Exchanges</span></h3><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">We would like to achieve the Privacy Preserving Prefetching while simultaneously maintaining the URL and Origin model of AMP documents. We are achieving this using a new collection of browser technologies being drafted under standards bodies such as the W3C and IETF, called “Signed Exchanges”.</span></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">A Signed Exchange is an HTTP Request / Response pair, cryptographically signed using a publisher’s own Certificate Private Key. In other words, Signed Exchanges provide digital proof to a browser that the document delivered by an AMP Cache has not been modified from what the publisher intended. </span></p><p><amp-img class=" size-full wp-image-2253 aligncenter amp-wp-enforced-sizes" src="https://amphtml.files.wordpress.com/2018/11/signed_exchange.png?w=660" alt="signed_exchange" srcset="https://amphtml.files.wordpress.com/2018/11/signed_exchange.png?w=660 660w, https://amphtml.files.wordpress.com/2018/11/signed_exchange.png?w=150 150w, https://amphtml.files.wordpress.com/2018/11/signed_exchange.png?w=300 300w, https://amphtml.files.wordpress.com/2018/11/signed_exchange.png?w=768 768w, https://amphtml.files.wordpress.com/2018/11/signed_exchange.png 807w" sizes="(min-width: 660px) 660px, 100vw" width="660" height="290"></amp-img></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">When a browser sees a Signed Exchange and can validate the signature, the browser can display the publisher’s URL, regardless of where the file was delivered from.</span></p><h3><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">AMP Packager</span></h3><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">To help publishers build Signed Exchanges, the AMP team has built a tool that can be run by publishers to package and serve Signed Exchanges. The tool is called the </span><a href="https://github.com/ampproject/amppackager"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">AMP Packager</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">.</span></p><p><amp-img class=" size-full wp-image-2250 aligncenter amp-wp-enforced-sizes" src="https://amphtml.files.wordpress.com/2018/11/packager.png?w=660" alt="packager" srcset="https://amphtml.files.wordpress.com/2018/11/packager.png?w=660 660w, https://amphtml.files.wordpress.com/2018/11/packager.png?w=150 150w, https://amphtml.files.wordpress.com/2018/11/packager.png?w=300 300w, https://amphtml.files.wordpress.com/2018/11/packager.png?w=768 768w, https://amphtml.files.wordpress.com/2018/11/packager.png 803w" sizes="(min-width: 660px) 660px, 100vw" width="660" height="363"></amp-img></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">The AMP Packager runs on publisher’s own infrastructure as a web server backend. It acts like a proxy, accepting an HTTP request for an AMP Web Package, forwarding that request to the publisher’s own backend, and then transforming it into a Signed Exchange. </span></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">In addition to packaging the document, the AMP Packager also applies transformations to the document that </span><a href="https://www.ampproject.org/latest/blog/turbocharging-amp/"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">optimize</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60"> the page for serving on an AMP Cache. These transformations modify the document itself, without changing the way it looks to users. However, publishers should be able to inspect the code that makes these transformations, so the AMP Packager code, including the transformations applied, is open source.</span></p><h2><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Developer Preview</span></h2><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Developers who want to opt-in to this developer preview should be first aware that the specification is still changing, and this is an implementation of a snapshot of it.</span></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Once deployed, allow a few days for the Google Search crawler to revisit your site, after which you should be able to try the experience by using the Google Search Demo instructions above.</span></p><h3><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Option A: Run the AMP Packager tool</span></h3><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">The AMP Project has provided the </span><a href="https://github.com/ampproject/amppackager"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">AMP Packager</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">, an open source tool, with detailed instructions on how to run it on your own infrastructure.</span></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">During these steps, you will need to generate a new certificate with the </span><a href="https://wicg.github.io/webpackage/draft-yasskin-httpbis-origin-signed-exchanges-impl.html#cross-origin-cert-req"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">CanSignHttpExchanges extension</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60"> from your Certificate Authority. At the time of writing, the only Certificate Authority that has built a Signed Exchange certificate request flow is </span><a href="https://www.digicert.com/"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">DigiCert</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">, with detailed instructions that can be found at </span><a href="https://www.digicert.com/account/ietf/http-signed-exchange.php"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Digicert CanSignHTTPExchanges</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">.</span></p><h3><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Option B: Use a Signed Exchange–Enabled CDN</span></h3><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">If you use a CDN provider, ask them if they can provide AMP Signed Exchanges. </span></p><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">At the time of writing, </span><a href="https://www.cloudflare.com/"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Cloudflare</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60"> has announced an experimental Cloudflare Worker application implementation of Signed Exchanges as a service to its customers. See <a href="https://blog.cloudflare.com/real-urls-for-amp-cached-content-using-cloudflare-workers/">this Cloudflare blog post about Web Packaging</a> for more information on how to enable Signed Exchanges on Cloudflare. </span><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Once deployed, allow a few days for the Google Search crawler to revisit your site, after which you should be able to try the experience by using the Google Search Demo instructions above.</span></p><h2><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">We’d love to hear from you</span></h2><p><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">We would love to hear your feedback on Signed Exchanges in AMP. You can join </span><a href="https://github.com/WICG/webpackage/issues"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">the spec discussion</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">, report </span><a href="https://bugs.chromium.org/p/chromium/issues/entry?status=untriaged&amp;components=Blink%3ELoader&amp;labels=Type-Bug,Hotlist-SignedExchange"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">a chrome bug</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">, report an </span><a href="https://github.com/ampproject/amppackager/issues/new?labels=developer+feedback"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">AMP Packager bug</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">, or </span><a href="https://github.com/ampproject/amphtml/blob/master/SUPPORT.md"><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">general AMP feedback</span></a><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">. Your feedback will greatly help us shape the future of AMP and the web.</span></p><p><i><span class="amp-wp-inline-329fdb7771c10d07df9eb73273c95a60">Posted by Greg Grothaus, Software Engineer, AMP at Google</span></i></p>	</div>

	

</div>

